<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="bulma.min.css" />
    <title>Offline Analytics</title>
  </head>
  <body>
    <article class="content">
      <h1 class="title">Home</h1>

      <button class="button" name="pizza" type="button">
        I want pizza
      </button>

      <button class="button" name="tarta" type="button">
        I want tarta
      </button>
    </article>

    <script>
      const sendMessage = (type, payload) => {
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({ type, payload });
        } else {
          console.log('SW not available');
        }
      };

      document.addEventListener('click', (event) => {
        if (event.target instanceof HTMLButtonElement) {
          sendMessage('event', {
            date: new Date(),
            name: 'buttonClick',
            payload: event.target.name,
          });
        }
      });

      navigator.serviceWorker.addEventListener('controllerchange', () => {
        sendMessage('event', {
          date: new Date(),
          name: 'url',
          payload: location.href,
        });
      });

      window.addEventListener('online', () => {
        sendMessage('onlineStatusChanged');
      });

      navigator.serviceWorker.register('/sw.js').then(() => {
        console.log('SW registered');
      });
    </script>
  </body>
</html>
